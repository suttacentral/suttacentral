<link rel="import" href="../bower_components/polymer/polymer.html">

<dom-module id="sc-cache-utility">
  <template>
    <style>
    </style>
  </template>

  <script>
      class SCCacheUtility extends Polymer.Element {
          static get is() {
              return 'sc-cache-utility';
          }

          async processRequests(dataSource) {
              let passed = 0;
              let failed = 0;
              for (let i = 0; i < dataSource.length; i++) {
                  try {
                      await this._fetchUrl(dataSource[i]);
                      passed++;
                  } catch (err) {
                      console.info(`request failed with ${err}`);
                      failed++;
                  }
              }
              return [passed, failed];
          }

          _fetchUrl(url) {
              caches.match(url).then((responseFromCache) => {
                  if (responseFromCache && responseFromCache.status === 200) {
                      // url is already cached
                      return;
                  }
                  return new Promise((resolve, reject) =>
                      fetch(url)
                          .then(this._handleErrors)
                          .then(response => response.json())
                          .then(resolve)
                          .catch(err => reject(err))
                  );
              });
          }

          _handleErrors(response) {
              if (!response.ok) {
                  throw Error(response.statusText);
              }
              return response;
          }

      }

      customElements.define(SCCacheUtility.is, SCCacheUtility);
  </script>
</dom-module>