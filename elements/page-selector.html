<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="sc-page-static.html">
<link rel="import" href="sc-view-suttaplex.html">
<link rel="import" href="sc-page-text.html">
<link rel="import" href="sc-segmented-text.html">
<link rel="import" href="sc-toolbar.html">
<link rel="import" href="sc-page-search.html">
<link rel="import" href="sc-page-dictionary.html">
<link rel="import" href="../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../bower_components/app-layout/app-header/app-header.html">
<link rel="import" href="../bower_components/app-layout/app-header-layout/app-header-layout.html">

<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">

<dom-module id="page-selector" attributes="togdraw">
<template>
<style is="custom-style">
:host {
  display: block;
  box-sizing: border-box;
}
   
.container {
  position: relative;
}

app-toolbar, sc-toolbar {
   background-color: var(--sc-gold-500);
   white-space: nowrap;
}

.list-mode #toolbarheader, .text-mode #toolbarheader, .segmented-mode #toolbarheader {
    @apply --shadow-elevation-8dp;
}

.list-mode #sctoolbar, .list-mode #toolbarheader {
  background-color: var(--paper-deep-orange-900);
}

.search-mode #sctoolbar, .search-mode #toolbarheader,  .dictionary-mode #sctoolbar, .dictionary-mode #toolbarheader{
  background-color: var(--sc-green-600);
}

#toolbartitlebox {
  width: 1px;
  z-index:-10;
}
#toolbartitle {
  text-transform: capitalize;
  @apply --sc-sans-font;
  color: white;
}
.search-mode #toolbartitle, .dictionary-mode #toolbartitle {
  text-transform: none;
}

@media screen and (max-width: 450px) {
    #toolbartitle {
      font-size:16px;
    }
}
#drawertoggle {
  z-index: 1;
  color: white;
}
@media screen and (min-width: 841px) {
    #drawertoggle {
      display: none;
    }
}
</style>
    <div class="container">
      <app-header-layout>
        <app-header id="header" condenses reveals effects="waterfall" slot="header" class$="[[mainClass]]">
                <app-toolbar id="toolbarheader">
                  <paper-icon-button icon="menu" id="drawertoggle" on-tap="_toggleDrawer"></paper-icon-button>
                  <div main-title id="toolbartitlebox"><p id="toolbartitle">[[toolbarTitle]]</p></div>
                  <sc-toolbar id="sctoolbar" input-language="[[inputLanguage]]" sutta-path="[[author]]" category="[[category]]" meta-area="[[metaArea]]"></sc-toolbar>
                </app-toolbar>
        </app-header>

            <template is="dom-if" if="[[_checkStatic(category)]]">
                <sc-page-static category="[[category]]" input-language="[[inputLanguage]]"></sc-page-static>
            </template>

            <template is="dom-if" if="[[_checkList(category)]]">
                <sc-view-suttaplex category="[[category]]" active-path="[[activePath]]" vagga-number="[[_computeVagga(subPath,activePath)]]" input-language="[[inputLanguage]]"></sc-view-suttaplex>
            </template>

            <template is="dom-if" if="[[_checkText(category,author)]]">
              <sc-page-text sutta-path="[[category]]" author="[[author]]" input-language="[[inputLanguage]]" show-paragraphs="[[showParagraphs]]"></sc-page-text>
            </template>

            <template is="dom-if" if="[[_checkSegmented(category,author)]]">
              <sc-segmented-text sutta-path="[[category]]" author="[[author]]" show-viewer="[[showViewer]]" input-language="[[inputLanguage]]" show-paragraphs="[[showParagraphs]]"></sc-segmented-text>
            </template>

            <template is="dom-if" if="[[_checkSearch(category)]]">
              <sc-page-search search-query="[[searchQuery]]" input-language="[[inputLanguage]]"></sc-page-search>
            </template>

            <template is="dom-if" if="[[_checkDictionary(category)]]">
              <sc-page-dictionary dictionary-item="[[dictionaryItem]]" input-language="[[inputLanguage]]"></sc-page-dictionary>
            </template>

      </app-header-layout>
    </div>
</template>
<script>
    Polymer({
      is: 'page-selector',
      properties: {
        inputLanguage: String,
        subPath: {
          type: String,
          notify: true
        },
        activePath: {
          type: Boolean,
          notify: true
        },
        toolbarTitle: {
          type: String,
          value: ""
        },
        metaArea: {
          type: String,
          value: ""
        },
        divisionTitle: {
          type: String,
          notify: true
        },
        suttaTitle: {
          type: String,
          notify: true
        },
        suttaMeta: {
          type: String,
          notify: true
        },
        suttaSegTitle: {
          type: String,
          notify: true
        },
        suttaSegMeta: {
          type: String,
          notify: true
        },
        showViewer: {
          type: String,
          notify: true
        },
        showParagraphs: Boolean,
        category: {
          type: String,
          notify: true,
          observer: '_changeView'
        },
        queryParams: {
          type: Object,
          notify: true
        },
        author: {
          type: String,
          notify: true,
          computed: '_checkAuthor(subPath,category,activePath)'
        },
        mainClass: String,
        staticPages: {
          type: Array,
          value: ["dons","people","downloads",""]
        },
        searchQuery: {
          type: String,
          notify: true,
          computed: '_checkSearchQuery(queryParams)'
        },
        dictionaryItem: {
          type: String,
          notify: true,
          computed: '_checkDictionaryItem(subPath,category,activePath)'
        }
      },
      observers: [
        '_changeView(category,author)'
      ],
      ready: function() {
        this.addEventListener('eventFromTextPage', this.addTitles);
        this.addEventListener('eventFromSuttaplexPage', this.addTitles);
        this.addEventListener('eventFromSegmentedTextPage', this.addTitles);
        this.addEventListener('eventFromTools', this.changeSegmentedView);
        this.addEventListener('changeTextInfo', this._changeTextInfo);
      },
      addTitles: function(event) {
        switch (this.mainClass) {
          case 'list-mode':
            if (event.detail.divisiontitle) {this.divisionTitle = event.detail.divisiontitle};
            this.toolbarTitle = this.divisionTitle;
            break;
          case 'text-mode':
            if (event.detail.suttatitle) {this.suttaTitle = event.detail.suttatitle};
            if (event.detail.suttameta) {this.suttaMeta = event.detail.suttameta};
            this.toolbarTitle = this.suttaTitle;
            this.metaArea = this.suttaMeta;
            break;
          case 'segmented-mode':
            if (event.detail.suttasegtitle) {this.suttaSegTitle = event.detail.suttasegtitle};
            if (event.detail.suttasegmeta) {this.suttaSegMeta = event.detail.suttasegmeta};
            this.toolbarTitle = this.suttaSegTitle;
            this.metaArea = this.suttaSegMeta;
            break;
        }
      },
      _checkAuthor: function(subPath,category,activePath) {
        if (category) {var matches = category.match(/\d{1,6}/)};
        return (subPath && activePath && matches && !subPath.startsWith("vagga")) ? subPath : "";
      },
      _computeVagga: function(subPath,activePath) {
        return (subPath && activePath && subPath.startsWith("vagga")) ? subPath : "";
      },
      _checkSearchQuery: function(queryParams) {
        return (queryParams.query) ? queryParams.query : "";
      },
      _checkDictionaryItem: function(subPath,category,activePath) {
        return (activePath && category === "define") ? subPath : "";
      },    
      changeSegmentedView: function(e) {
          return this.showViewer = e.detail.selectedView;
      },
      _changeTextInfo: function(e) {
        return this.showParagraphs = e.detail.textInfo;
      },
      _changeView: function(category,author) {
        this.$.sctoolbar.closeSearch();
        this.$.header.resetLayout();
      },

      _toggleDrawer: function() {
                this.fire('toggleDrawer',{togdraw:"opened"});
      },
      _checkStatic: function(category) {
        if (this.staticPages.indexOf(category) > -1){
          this.mainClass="static-mode";
          this.toolbarTitle = ''
          return true;
        } else {
        return false;
        }
      },
      _checkList: function(category) {
        if ((this.staticPages.indexOf(category) == -1) && category !== 'search' && category !== 'define') {
          this.mainClass="list-mode";
          this.toolbarTitle = this.divisionTitle;
          return true;
        } else {
          return false;
        }
      },
      _checkText: function(category,author) {
        if (category) {var matches = category.match(/\d{1,6}/)};
        if (matches && author && author !== "sujato") {
            this.mainClass="text-mode";
            this.toolbarTitle = this.suttaTitle;
            this.metaArea = this.suttaMeta;
            return true;
        } else {        
            return false;
        }
      },
      _checkSegmented: function(category,author) {
        if (category) {var matches = category.match(/\d{1,6}/)};
        if (matches && author && author === "sujato") {
            this.mainClass="segmented-mode";
            this.toolbarTitle = this.suttaSegTitle;
            this.metaArea = this.suttaSegMeta;
            return true;
        } else {
            return false;
        }
      },
      _checkSearch: function(category) {
        if (category === "search"){
          this.mainClass="search-mode";
          this.toolbarTitle = 'SuttaCentral — search results'
          return true;
        } else {
        return false;
        }
      },
      _checkDictionary: function(category) {
        if (category === "define"){
          this.mainClass="dictionary-mode";
          this.toolbarTitle = 'SuttaCentral — Dictionary results'
          return true;
        } else {
        return false;
        }
      }
    });
</script>
</dom-module>